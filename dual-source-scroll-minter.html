Waiting for confirmation...`, 'info');
                
                const receipt = await tx.wait();
                if (receipt.status !== 1) {
                    throw new Error(`${networkName} transaction failed`);
                }
                
                completeStep(4);
                
                // Step 5: Confirmation
                updateProgress(5);
                
                // Update wallet info display
                const balance = await provider.getBalance(userAddress);
                document.getElementById('walletAddress').textContent = userAddress;
                document.getElementById('currentNetwork').textContent = networkName;
                document.getElementById('ethBalance').textContent = ethers.utils.formatEther(balance) + ' ETH';
                document.getElementById('walletInfo').style.display = 'block';
                
                // Success message
                const successMessage = `🎉 ${networkName.toUpperCase()} MINTING COMPLETE! 🎉\n\n` +
                    `✨ Auto-processed scroll from ${selectedFile.source || 'selected source'} successfully minted!\n` +
                    `📜 Title: ${title}\n` +
                    `📌 CID: ${cid}\n` +
                    `🔗 Transaction: ${tx.hash}\n` +
                    `🛡️ Wallet: ${recipient}\n` +
                    `⛓️ Block: ${receipt.blockNumber}\n\n` +
                    `${isL1 ? 
                        '💰 L1 Benefits:\n• Perpetual 0.618% royalty stream ACTIVE\n• Permanent anchor established\n• Immutable IP record' :
                        '🚀 L2 Benefits:\n• KBT tokens generated\n• Ultra-low cost operation\n• Near-instant confirmation'
                    }\n\n🌟 Ready for another mint on the other network!`;
                
                updateStatus(successMessage, 'success');
                completeStep(5);
                
                // Update button text but keep it functional
                const button = isL1 ? document.getElementById('mintL1') : document.getElementById('mintL2');
                button.textContent = `🎉 ${isL1 ? 'L1' : 'L2'} Complete!`;
                button.className = `button ${isL1 ? 'l1' : 'l2'} success`;
                
                // Re-enable the other button for dual minting option
                const otherButton = isL1 ? document.getElementById('mintL2') : document.getElementById('mintL1');
                otherButton.disabled = false;
                
                // Re-enable this button after a delay for re-minting
                setTimeout(() => {
                    button.disabled = false;
                    button.textContent = `🔄 Re-mint on ${isL1 ? 'L1' : 'L2'}`;
                    button.className = `button ${isL1 ? 'l1' : 'l2'}`;
                }, 5000);
                
            } catch (error) {
                failStep(4);
                updateStatus(`❌ ${isL1 ? 'L1' : 'L2'} minting failed: ${error.message}`, 'error');
                
                // Re-enable buttons
                document.getElementById('mintL1').disabled = false;
                document.getElementById('mintL2').disabled = false;
            }
        }

        // Event listeners
        document.getElementById('loadPinataFiles').addEventListener('click', loadPinataFiles);
        document.getElementById('loadRepoFiles').addEventListener('click', loadRepoFiles);
        document.getElementById('validateParams').addEventListener('click', validateParameters);
        document.getElementById('mintL1').addEventListener('click', () => executeMint(true));
        document.getElementById('mintL2').addEventListener('click', () => executeMint(false));

        // Initialize particles on load
        window.addEventListener('load', createParticles);
        
        // Initialize
        updateStatus('Ready for Apex dual-source minting! Choose Pinata or Repo files to begin. 🌌');
    </script>
</body>
</html>